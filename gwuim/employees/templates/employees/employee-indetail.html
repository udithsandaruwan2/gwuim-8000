{% extends 'dashboard/main.html' %}

{% load static %}
{% load custom_filters %}


{% block content %}
<div class="body-wrapper" style="margin: 0; padding: 0;">
    <div class="container-fluid">
        <div class="row mb-4">
            <div class="col-8 d-flex align-items-center">
                <img src="{% static 'theme_dashboard/assets/images/logos/logo.png' %}" width="190" alt="Company Logo" />
            </div>
            <div class="col-4 text-end">

                {% if page != 'employees_leave_from_attendance' %}

                <!-- Visible on Web Page -->
                <button class="btn me-2 toggle-btn" data-bs-toggle="modal" data-bs-target="#addLeaveModal">
                    <i class="fas fa-plus"></i> Add Leave
                </button>
                <button class="btn me-2 toggle-btn">
                    <i class="fas fa-undo"></i> Return Leave
                </button>

                {% endif %}
 
                <!-- Report Download Button -->
                <!-- <button class="btn toggle-btn" id="downloadBtn">
                    <i class="fas fa-download"></i> Download Report
                </button> -->
                
                <!-- Content to be captured (optional, you can wrap the content in a div for better control) -->
                <div id="contentToCapture">
                    <!-- Your content here -->
                </div>

            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12 d-flex align-items-center justify-content-center">
                <h6 class="mb-0 ms-3 text-center">{{ employee.full_name }} ( {{ employee.uid }} ) - {{ current_year }}</h6>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Leave Types</th>
                        <th>January</th>
                        <th>February</th>
                        <th>March</th>
                        <th>April</th>
                        <th>May</th>
                        <th>June</th>
                        <th>July</th>
                        <th>August</th>
                        <th>September</th>
                        <th>October</th>
                        <th>November</th>
                        <th>December</th>
                    </tr>
                </thead>
                <tbody>

                {% if page == 'employees_leave_from_attendance' %}

                <tr>
                    <td>Absent</td>

                    {% for days in leave_days %}
                    <td>{{ days|floatformat:0 }}</td>
                    {% endfor %}
                </tr>

                {% else %}

                {% for data in leaves_data %}
                <tr>
                    <td>{{ data.leave_type_name }}</td>
                    {% for days in data.leave_days_array %}
                    <td>{{ days|floatformat:0 }}</td>
                    {% endfor %}
                
                </tr>
                {% endfor %}

                {% endif %}
           
                </tbody>

            </table>

        </div>

    {% if page != 'employees_leave_from_attendance' %}
        <div class="text-end">
            <a href="{% url 'leave_requests_history' employee.uid %}" class="btn toggle-btn" id="downloadBtn">
                <i class="fas fa-book"></i> View History
            </a>
        </div>


        <div class="table-responsive mt-4">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th></th>

                        {% for type in leave_types %}

                        <th>{{ type.name }}</th>

                        {% endfor %}

                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="width: fit-content;">Total leave balance</td>
                        {% for type in leave_types %}
                        <th>{{ employee.leave_balance|get_dic_item:type|get_value }} / {{type.max_days|get_value}} </th>
                        {% endfor %}

                    </tr>
                </tbody>
        

        
            </table>
        
        </div>
    {% else %}







    <div class="text-end mt-5 mb-3">
        <div class="col-12">
            
            
            <div class="radio-container">
                <div class="radio-group" id="radioGroup">
                    <div class="background-slide" id="slider"></div>

                <!-- ✅ 1. Trigger on page load using hidden div -->
                <div id="initial-load" hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 1 %}"
                    hx-target="#leave_data" hx-swap="innerHTML" hx-trigger="load">
                </div>
                
                <!-- ✅ 2. Enable click interaction afterward -->
                <input type="radio" name="btnradio" id="btnradio1" class="radio-input" value="1"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 1 %}" hx-target="#leave_data"
                    hx-swap="innerHTML">

                    <label class="radio-label" for="btnradio1">January</label>
            
                    <input type="radio" name="btnradio" id="btnradio2" class="radio-input"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 2 %}" hx-target="#leave_data"
                        hx-swap="innerHTML"  value="February">
                    <label class="radio-label" for="btnradio2">February</label>
            
                    <input type="radio" name="btnradio" id="btnradio3" class="radio-input"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 3 %}" hx-target="#leave_data"
                        hx-swap="innerHTML"  value="March">
                    <label class="radio-label" for="btnradio3">March</label>
            
                    <input type="radio" name="btnradio" id="btnradio4" class="radio-input"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 4 %}" hx-target="#leave_data"
                        hx-swap="innerHTML"  value="April">
                    <label class="radio-label" for="btnradio4">April</label>
            
                    <input type="radio" name="btnradio" id="btnradio5" class="radio-input"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 5 %}" hx-target="#leave_data"
                        hx-swap="innerHTML"  value="May">
                    <label class="radio-label" for="btnradio5">May</label>
            
                    <input type="radio" name="btnradio" id="btnradio6" class="radio-input"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 6 %}" hx-target="#leave_data"
                        hx-swap="innerHTML"  value="June">
                    <label class="radio-label" for="btnradio6">June</label>
            
                    <input type="radio" name="btnradio" id="btnradio7" class="radio-input"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 7 %}" hx-target="#leave_data"
                        hx-swap="innerHTML"  value="July">
                    <label class="radio-label" for="btnradio7">July</label>
            
                    <input type="radio" name="btnradio" id="btnradio8" class="radio-input"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 8 %}" hx-target="#leave_data"
                        hx-swap="innerHTML"  value="August">
                    <label class="radio-label" for="btnradio8">August</label>
            
                    <input type="radio" name="btnradio" id="btnradio9" class="radio-input"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 9 %}" hx-target="#leave_data"
                        hx-swap="innerHTML"  value="September">
                    <label class="radio-label" for="btnradio9">September</label>
            
                    <input type="radio" name="btnradio" id="btnradio10" class="radio-input"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 10 %}" hx-target="#leave_data"
                        hx-swap="innerHTML"  value="October">
                    <label class="radio-label" for="btnradio10">October</label>
            
                    <input type="radio" name="btnradio" id="btnradio11" class="radio-input"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 11 %}" hx-target="#leave_data"
                        hx-swap="innerHTML"  value="November">
                    <label class="radio-label" for="btnradio11">November</label>
            
                    <input type="radio" name="btnradio" id="btnradio12" class="radio-input"
                    hx-get="{% url 'get_other_leave_data' employee.employee_code current_year 12 %}" hx-target="#leave_data"
                        hx-swap="innerHTML"  value="December">
                    <label class="radio-label" for="btnradio12">December</label>
                </div>
            </div>
              
            



              

        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const radios = document.querySelectorAll('input[name="btnradio"]');
            const slider = document.getElementById('slider');
            const radioGroup = document.getElementById('radioGroup');
            const initialLoadDiv = document.getElementById('initial-load');

            function moveSlider() {
                const checkedRadio = document.querySelector('input[name="btnradio"]:checked');
                if (!checkedRadio) return;

                const label = checkedRadio.nextElementSibling;
                if (!label || !slider || !radioGroup) return;

                const groupRect = radioGroup.getBoundingClientRect();
                const labelRect = label.getBoundingClientRect();

                slider.style.width = `${labelRect.width}px`;
                slider.style.transform = `translateX(${labelRect.left - groupRect.left}px)`;
            }

            // Move slider on load and resize
            window.addEventListener('load', moveSlider);
            window.addEventListener('resize', moveSlider);

            // Move slider and toggle checked class on radio change
            radios.forEach(radio => {
                radio.addEventListener('change', () => {
                    radios.forEach(r => r.classList.remove('checked'));
                    radio.classList.add('checked');
                    moveSlider();
                });
            });

            // Apply checked class after HTMX initial load
            if (initialLoadDiv) {
                initialLoadDiv.addEventListener('htmx:afterRequest', function () {
                    const firstRadio = document.getElementById('btnradio1');
                    if (firstRadio) {
                        firstRadio.classList.add('checked');
                        firstRadio.checked = true;
                        moveSlider();
                    }
                });
            }
        });
    </script>
    
    <style>
        .radio-container {
            background-color: #ffffff;
            padding: 0.4rem 0.4rem;
            border-radius: 3rem;
            box-shadow: 0 8px 24px rgba(63, 63, 63, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    
        .radio-group {
            position: relative;
            display: flex;
            gap: 0.5rem;
        }
    
        .radio-input {
            display: none;
        }
    
        .radio-label {
            position: relative;
            padding: 0.4rem 1rem;
            border: 2px solid transparent;
            border-radius: 999px;
            color: #932626;
            font-weight: 500;
            cursor: pointer;
            z-index: 1;
            transition: color 0.3s ease, background-color 0.3s ease;
        }
    
        .radio-input:checked+.radio-label {
            color: rgb(255, 255, 255);
        }
    
        .radio-input:not(:checked)+.radio-label:hover {
            background-color: #ffffff;
        }
    
        .radio-label:active {
            transform: scale(0.96);
        }
    
        .background-slide {
            position: absolute;
            height: 100%;
            width: auto;
            background-color: #932626;
            border-radius: 999px;
            z-index: 0;
            transition: all 0.3s ease;
        }
    </style>


    
    
    <div class="table-responsive mt-4" id="leave_data">
        <!-- table.html will render here -->
    </div>
    
















    {% endif %}
        
        
    </div>



</div>
<div class="row " style="align-items: center; text-align: center;">
    <div class="copyright" >
        {% include 'dashboard/footer.html' %}
    </div>
</div>

{% include 'employees/leave-add-model.html' %}

<style>
    .toggle-btn {
                        background-color: #932626;
                        color: #ffffff;
                        border-color: #932626;
                        transition: all 0.3s ease-in-out;
                    }

                    .toggle-btn:hover {
                        background-color: #ffffff;
                        color: #932626;
                        border-color: #932626;
                    }
    /* Table Styling */
    .table {
        border-radius: 10px;
        overflow: hidden;
        border-collapse: separate;
        border-spacing: 0;
    }

    .table th,
    .table td {
        border: 1px solid #dee2e6;
    }

    .table thead th:first-child {
        border-top-left-radius: 10px;
    }

    .table thead th:last-child {
        border-top-right-radius: 10px;
    }

    .table tbody tr:last-child td:first-child {
        border-bottom-left-radius: 10px;
    }

    .table tbody tr:last-child td:last-child {
        border-bottom-right-radius: 10px;
    }

    .table th, .table td {
        text-align: center;
    }

    /* Print Styling */
    /* Improved Table Styling for Print */
@media print {
    .table th, .table td {
        width: 6%;  /* Optimize space for each month column */
        padding: 4px;  /* Reduce padding for better fit */
        font-size: 12px; /* Smaller text for compact display */
        word-wrap: break-word;
        text-align: center;
        border: 1px solid #000000;
    }

    .table th:first-child, .table td:first-child {
        width: 20%; /* Maintain enough space for 'Leave Types' column */
    }

    .body-wrapper {
        width: 100%;
        padding: 0;
        margin: 0;
    }

    .container-fluid {
        width: 100%;
        padding: 0;
    }

    .toggle-btn {
        display: none; /* Hide buttons when printing */
    }
}



    /* Adjust the width of the "Leave Types" column */
    .table th:first-child,
    .table td:first-child {
        width: 20%;
    }
</style>

<script>
    document.getElementById("downloadBtn").addEventListener("click", function () {
        // Target the content you want to capture
        const content = document.getElementById("contentToCapture");

        // Use html2canvas to capture the screenshot
        html2canvas(content).then(function (canvas) {
            // Create a new jsPDF instance
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Convert the canvas to an image and add it to the PDF
            const imgData = canvas.toDataURL("image/png");
            doc.addImage(imgData, "PNG", 10, 10, 180, 160);  // Adjust coordinates and size

            // Save the generated PDF
            doc.save("report.pdf");
        });
    });
</script>


{% endblock content %}